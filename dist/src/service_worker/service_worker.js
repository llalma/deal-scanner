var h=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var n=(t,e,a)=>new Promise((c,i)=>{var s=r=>{try{l(a.next(r))}catch(u){i(u)}},o=r=>{try{l(a.throw(r))}catch(u){i(u)}},l=r=>r.done?c(r.value):Promise.resolve(r.value).then(s,o);l((a=a.apply(t,e)).next())});import{s as f}from"../helpers/helpers.js";var w=h(m=>{function d(t,e){return n(this,null,function*(){const a=(yield chrome.storage.sync.get([t]))[t],c=Object.assign({},a,e);chrome.storage.sync.set({[t]:c})})}y();chrome.storage.onChanged.addListener((t,e)=>n(m,null,function*(){e==="sync"&&y()}));function y(){return n(this,null,function*(){const e=Object.entries(yield chrome.storage.sync.get()).filter((a,c)=>a[1].alert_bool).length;chrome.action.setBadgeText({text:String(e)})})}function g(t){return new Promise((e,a)=>{let c;const i=()=>{try{const o=document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;return o?(clearTimeout(c),e(o.textContent),!0):!1}catch(o){return!1}},s=()=>{(document.readyState==="interactive"||document.readyState==="complete")&&i()||setTimeout(s,100)};s()})}function p(t,e){return n(this,null,function*(){return(yield chrome.scripting.executeScript({target:{tabId:t},func:g,args:[e]}))[0].result})}function _(t,e){return n(this,null,function*(){const a=yield chrome.tabs.create({url:e.link,active:!0}),c=yield p(a.id,e.xpath);parseFloat(f(c))<parseFloat(e.target_price)&&(yield d(t,{alert_bool:!0})),chrome.tabs.remove(a.id)})}function b(t){return n(this,null,function*(){yield Promise.all(t.map(c=>n(this,[c],function*([e,a]){console.log(`Starting item ${e}`),yield _(e,a)})))})}chrome.runtime.onMessage.addListener((t,e,a)=>n(m,null,function*(){switch(t.type){case"scan":yield b(t.payload);break;case"update":yield d(t.payload.key,t.payload.data);break;case"remove_css":yield chrome.scripting.removeCSS({files:["src/injections/injection.css"],target:{tabId:e.tab.id}});break;default:console.error(`Not a valid message type: ${t.type}`)}}))});export default w();
